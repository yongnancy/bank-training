<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Video Verification Training App</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; height: 100vh; margin: 0; }
        #left-panel { width: 40%; border-right: 1px solid #ccc; padding: 10px; overflow-y: auto; }
        #right-panel { width: 60%; padding: 10px; }
        .scene-group { margin-bottom: 20px; }
        .sentence-item { cursor: pointer; display: flex; align-items: center; margin-bottom: 5px; }
        .sentence-item input { margin-right: 10px; }
        .sentence-item.familiar { color: green; }
        .sentence-item.unfamiliar { color: red; }
        #current-sentence { font-size: 18px; margin-bottom: 20px; }
        #controls { display: flex; flex-direction: column; }
        button { margin-right: 10px; margin-bottom: 10px; }
        #speed-slider { width: 200px; }
        #total-count { margin-bottom: 10px; }
        @media (max-width: 768px) {
            body { flex-direction: column; }
            #left-panel { width: 100%; height: 50%; border-right: none; border-bottom: 1px solid #ccc; }
            #right-panel { width: 100%; height: 50%; }
        }
    </style>
</head>
<body>
    <div id="left-panel">
        <h2>Corpus Browser</h2>
        <div id="total-count"></div>
        <div id="sentence-list"></div>
    </div>
    <div id="right-panel">
        <h2>Training Interface</h2>
        <div id="current-sentence"></div>
        <div id="controls">
            <button id="play-btn">Play</button>
            <button id="stop-btn">Stop</button>
            <button id="loop-btn">Toggle Loop (Off)</button>
            <button id="next-btn">Next</button>
            <button id="repeat-btn">Repeat Current</button>
            <label for="speed-slider">Speed: <span id="speed-value">1.0</span>x</label>
            <input type="range" id="speed-slider" min="0.75" max="2" step="0.25" value="1">
            <div>
                <input type="checkbox" id="familiar-checkbox"> Familiar
            </div>
        </div>
    </div>

    <script>
        // Define stages for Bank Video Verification full flow (24 sentences total)
        const stages = {
            'Greeting and Introduction': [
                "Hello, thank you for choosing our bank. We will now begin the video verification process.",
                "Welcome to the secure video identity verification for your account.",
                "Good day, this is the video authentication step to ensure your security."
            ],
            'Instructions for Setup': [
                "Please ensure your camera is on and you are in a well-lit area.",
                "Make sure your face is clearly visible and there are no obstructions.",
                "Position yourself so that your full face is centered in the camera frame."
            ],
            'Request for ID Document': [
                "Please hold your government-issued ID up to the camera.",
                "Show your driver's license or passport clearly in front of the webcam.",
                "Display your identification card so that all details are readable."
            ],
            'Face Verification': [
                "Now, look directly into the camera and hold still for a moment.",
                "Please smile and turn your head slightly to the left and right.",
                "Blink your eyes twice while facing the camera for verification."
            ],
            'Information Confirmation': [
                "Can you please state your full name as it appears on your ID?",
                "Verify your date of birth for the record.",
                "Confirm your account number or the last four digits of your social security number."
            ],
            'Additional Checks': [
                "We need to verify the address on your ID matches our records.",
                "Please read the security code displayed on your screen.",
                "Answer this security question: What is your mother's maiden name?"
            ],
            'Error Handling': [
                "The image is not clear; please hold the ID steady and try again.",
                "We couldn't detect your face properly; adjust your lighting.",
                "Verification failed; let's retry the process from the beginning."
            ],
            'Completion and Closing': [
                "Verification successful. Your account is now activated.",
                "Thank you for completing the video verification. Have a great day.",
                "Process complete. You will receive a confirmation email shortly."
            ]
        };

        // Flatten all sentences with metadata
        let allSentences = [];
        Object.keys(stages).forEach(stage => {
            stages[stage].forEach(sentence => {
                allSentences.push({ stage, sentence, familiar: false });
            });
        });

        // Load from localStorage if available
        const storedData = localStorage.getItem('sentenceData');
        if (storedData) {
            allSentences = JSON.parse(storedData);
        }

        // Save to localStorage
        function saveData() {
            localStorage.setItem('sentenceData', JSON.stringify(allSentences));
        }

        // Render left panel
        function renderLeftPanel() {
            const list = document.getElementById('sentence-list');
            list.innerHTML = '';
            Object.keys(stages).forEach(stage => {
                const group = document.createElement('div');
                group.className = 'scene-group';
                group.innerHTML = `<h3>${stage}</h3>`;
                allSentences.filter(s => s.stage === stage).forEach((item, index) => {
                    const globalIndex = allSentences.findIndex(s => s.stage === stage && s.sentence === item.sentence);
                    const div = document.createElement('div');
                    div.className = 'sentence-item ' + (item.familiar ? 'familiar' : 'unfamiliar');
                    div.innerHTML = `
                        <input type="checkbox" ${item.familiar ? 'checked' : ''} data-index="${globalIndex}">
                        ${item.sentence}
                    `;
                    div.querySelector('input').addEventListener('change', (e) => {
                        allSentences[globalIndex].familiar = e.target.checked;
                        saveData();
                        renderLeftPanel();
                    });
                    div.addEventListener('click', () => loadSentence(globalIndex));
                    group.appendChild(div);
                });
                list.appendChild(group);
            });

            // Total count
            document.getElementById('total-count').textContent = `Total Sentences: ${allSentences.length}`;
        }

        renderLeftPanel();

        // Training logic
        let currentIndex = 0;
        let isLooping = false;
        let speech = new SpeechSynthesisUtterance();
        let speed = 1.0;
        speech.lang = 'en-US'; // Assuming English, but can adjust if needed

        // Select natural female voice when voices are loaded
        speechSynthesis.onvoiceschanged = () => {
            const voices = speechSynthesis.getVoices();
            // Prefer Google female voices or any natural-sounding female voice
            const preferredVoice = voices.find(v => 
                v.lang.startsWith('en-') && 
                (v.name.includes('Google US English') || v.name.includes('Google') && v.name.includes('female') || 
                 v.name.includes('Samantha') || v.name.includes('Female') || v.name.includes('Premium'))
            ) || voices.find(v => v.lang.startsWith('en-') && v.gender === 'female');
            if (preferredVoice) {
                speech.voice = preferredVoice;
            }
        };

        // Trigger voices loading if not already
        speechSynthesis.getVoices();

        function loadSentence(index) {
            currentIndex = index;
            const item = allSentences[index];
            document.getElementById('current-sentence').textContent = item.sentence;
            document.getElementById('familiar-checkbox').checked = item.familiar;
            speech.text = item.sentence;
            speech.rate = speed;
        }

        // Play button
        document.getElementById('play-btn').addEventListener('click', () => {
            speechSynthesis.cancel();
            speechSynthesis.speak(speech);
            if (isLooping) {
                speech.onend = () => {
                    if (isLooping) speechSynthesis.speak(speech);
                };
            }
        });

        // Stop button
        document.getElementById('stop-btn').addEventListener('click', () => {
            speechSynthesis.cancel();
            isLooping = false;
            document.getElementById('loop-btn').textContent = `Toggle Loop (Off)`;
            speech.onend = null;
        });

        // Loop toggle
        document.getElementById('loop-btn').addEventListener('click', () => {
            isLooping = !isLooping;
            document.getElementById('loop-btn').textContent = `Toggle Loop (${isLooping ? 'On' : 'Off'})`;
            if (isLooping && speechSynthesis.speaking) {
                speech.onend = () => {
                    if (isLooping) speechSynthesis.speak(speech);
                };
            } else {
                speech.onend = null;
            }
        });

        // Next button - skip familiar, go to next unfamiliar
        document.getElementById('next-btn').addEventListener('click', () => {
            let nextIndex = (currentIndex + 1) % allSentences.length;
            while (allSentences[nextIndex].familiar) {
                nextIndex = (nextIndex + 1) % allSentences.length;
                if (nextIndex === currentIndex) break; // All familiar
            }
            loadSentence(nextIndex);
            speechSynthesis.cancel();
            speechSynthesis.speak(speech);
            if (isLooping) {
                speech.onend = () => {
                    if (isLooping) speechSynthesis.speak(speech);
                };
            }
        });

        // Repeat current
        document.getElementById('repeat-btn').addEventListener('click', () => {
            speechSynthesis.cancel();
            speechSynthesis.speak(speech);
            if (isLooping) {
                speech.onend = () => {
                    if (isLooping) speechSynthesis.speak(speech);
                };
            }
        });

        // Speed slider
        const speedSlider = document.getElementById('speed-slider');
        const speedValue = document.getElementById('speed-value');
        speedSlider.addEventListener('input', () => {
            speed = parseFloat(speedSlider.value);
            speedValue.textContent = speed.toFixed(2);
            speech.rate = speed;
        });

        // Familiar checkbox in right panel
        document.getElementById('familiar-checkbox').addEventListener('change', (e) => {
            allSentences[currentIndex].familiar = e.target.checked;
            saveData();
            renderLeftPanel();
        });

        // Initial load
        loadSentence(0);
    </script>
</body>
</html>
